## 消息重复消费：
什么是消息重复消费？
首先清楚消息的传输流程。  
消息的传输流程：  
消息生产者--> MQ -->消息消费者。消息生产者发送消息到MQ，MQ存储消息，消息消费者监听MQ的消息，发现有消息就消费消息。  
所以，消息重复也就出现在两个阶段。  
1. 生产者多发送了消息给MQ。
2. MQ的一条消息被消费者消费了很多次。
## 防止生产者重复发送消息的方法
这个RabbitMQ是有发布确认这种机制的，他会确保消息已被RabbitMQ成功接收，避免因网络问题导致重复发送。
## 防止MQ的一条消息被消费值消费量多次
情况：  
消费者消费消息成功后，在给MQ发送消息确认的时候出现了网络异常（或者是服务中断）,MQ没有接收到确认，此时MQ不会将发送的消息删除。为了保证消息被消费，当消费者的网络稳定后，MQ就会继续给消费者投递之前的消息，这时候消费者就接收到了两条一样的消息。  

解决：
为了保证消息不被重复消费，首先要保证每个消息是唯一的，所以可以给每一个消息携带一个全局唯一的id。流程如下：  
1. 消费者监听到消息后获取id，先去查询这个id是否存在
2. 如果不存在，则正常消费消息，并把消息的id存入数据库或者redis中
3. 如果存在则丢弃此消息，不消费。

怎么存入redis呢？  
这个选择的方案有很多，比如可以直接存string中，消息id作为key，具体的消息作为value,并设置过期时间。当然也可以存在list里面，监听的队列的routingkey作为键，消息的id作为value，存消息也没必要。
